{
    "$id": "https://aka.ms/schemas/dsc/configuration.schema.0.1.yaml",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "description": "A representation of a configuration used by an orchestrator for WinDSC.",
    "type": "object",
    "properties": {
        "assertions": {
            "type": "array",
            "items": { "$ref": "#/defs/resource" }
        },
        "resources": {
            "type": "array",
            "items": { "$ref": "#/defs/resource" }
        },
        "parameters": {
            "type": "array",
            "items": { "$ref": "#/defs/resource" },
            "description": "Resources that retrieve information via a 'get' operation."
        },
        "configurationType": {
            "type": "string",
            "default": "dsc",
            "const": "dsc",
            "description": "The configuration type."
        },
        "configurationVersion": {
            "type": "string",
            "default": "0.1",
            "pattern": "^(0|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])(\\.(0|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])){2}$",
            "description": "The configuration syntax version"
        }
    },
    "$defs": {
        "resource": {
            "type": "object",
            "properties": {
                "resourceName": {
                    "type": "string",
                    "maxLength": 128,
                    "description": "The name of the resource."
                },
                "id": {
                    "$ref": "#/defs/id"
                },
                "dependsOn": {
                    "type": [ "string", "null" ],
                    "description": "The list of resource ids identifying dependencies.",
                    "uniqueItems": true
                },
                "attribute": {
                    "type": "object",
                    "properties": {
                        "module": {
                            "$ref": "#/defs/module"
                        },
                        "description": {
                            "$ref": "#/defs/description"
                        }
                    }
                },
                "settings": {
                    "type": "object",
                    "properties": {
                        "module": {
                            "$ref": "#/def/module"
                        },
                        "version": {
                            "$ref": "#/def/version"
                        },
                        "minimumVersion": {
                            "$ref": "#/def/version"
                        },
                        "productId": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The product id."
                        },
                        "channelId": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The channel id."
                        },
                        "publisher": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The name of the publisher."
                        },
                        "vsconfigFile": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The VS config file."
                        },
                        "os": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The operating system."
                        },
                        "vaultType": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The key vault type."
                        },
                        "vaultName": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The name of the key vault."
                        },
                        "apikey": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The api key."
                        },
                        "repository": {
                            "type": "string",
                            "maxLength": 128,
                            "description": "The name of the repository."
                        },
                        "extensions": {
                            "type": [ "string", "null" ],
                            "description": "The list of extensions",
                            "uniqueItems": true
                        },
                        "windowsUpdate": {
                            "type": [ "boolean", "null" ],
                            "description": "Indicates whether to allow Windows to update."
                        }
                    }
                },
                "directives": {
                    "type": "object", 
                    "properties": {
                        "requiredVersion": {
                            "$ref": "#/defs/version"
                        },
                        "timeoutSeconds": {
                            "type": "integer",
                            "minimum": 0,
                            "maximum": 6000,
                            "description": "The number of seconds to wait before timing out."
                        },
                        "runAs": {
                            "type": "string",
                            "enum": [
                              "admin",
                              "user"
                            ],
                            "description": "Enum determining whether to run as admin or user. Default is user."
                        },
                        "sha256Hash": {
                            "type": "string",
                            "pattern": "^[A-Fa-f0-9]{64}$",
                            "description": "SHA256 hash of the resource."
                        },
                        "optional": {
                            "type": [ "boolean", "null" ],
                            "description": "Indicates whether to inform the orchestrator to prompt user for install. Default is false."
                        },
                        "confirm": {
                            "type": [ "boolean", "null" ],
                            "description": "Indicates whether to prompt the user for confirmation before initiation."
                        },
                        "signerThumbprint": {
                            "type": "string",
                            "pattern": "^[A-Fa-f0-9]{40}$",
                            "description": "The signer thumbprint."
                        },
                        "onFailure": {
                            "type": "string",
                            "enum": [
                              "continue",
                              "stop"
                            ],
                            "description": "Determines the behavior if a failure is encountered."
                        }
                    }
                }
            },
            "required": [
                "resourceName",
                "id"
            ]
        },
        "id": {
            "type": "string",
            "maxLength": 128,
            "description": "The identifier of the resource."
        },
        "module": {
            "type": "string",
            "maxLength": 128,
            "description": "The name of the module."
        },
        "description": {
            "type": "string",
            "maxLength": 512,
            "description": "The description of the resource."
        },
        "version": {
            "type": "string",
            "pattern": "^[^\\\\/:\\*\\?\"<>\\|\\x01-\\x1f]+$",
            "maxLength": 128
        }
    }
}