{
    "$id": "https://aka.ms/schemas/dsc/configuration.schema.0.1.yaml",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "description": "A representation of a configuration used by an orchestrator for WinDSC.",
    "type": "object",
    "properties": {
        "assertions": {
            "type": "array",
            "items": { "$ref": "#/defs/resource" }
        },
        "resources": {
            "type": "array",
            "items": { "$ref": "#/defs/resource" }
        },
        "parameters": {
            "type": "array",
            "items": { "$ref": "#/defs/resource" },
            "description": "Resources that retrieve information via a 'get' operation."
        },
        "configurationVersion": {
            "type": "string",
            "default": "0.1",
            "pattern": "^(?P<major>0|[1-9]\\d*)\\.(?P<minor>0|[1-9]\\d*)\\.(?P<patch>0|[1-9]\\d*)(?:-(?P<prerelease>(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+(?P<buildmetadata>[0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
            "description": "The configuration syntax version"
        }
    },
    "$defs": {
        "resource": {
            "type": "object",
            "properties": {
                "resource": {
                    "type": "string",
                    "maxLength": 128,
                    "description": "The name of the resource."
                },
                "id": {
                    "$ref": "#/defs/id"
                },
                "dependsOn": {
                    "type": [ "array", "null" ],
                    "items": {
                        "type": "string"
                    },
                    "uniqueItems": true,
                    "description": "The list of resource ids identifying dependencies."
                },
                "directives": {
                    "type": "object", 
                    "properties": {
                        "module": {
                            "$ref": "#/defs/module"
                        },
                        "description": {
                            "$ref": "#/defs/description"
                        },
                        "requiredVersion": {
                            "$ref": "#/defs/version"
                        },
                        "timeoutSeconds": {
                            "type": "integer",
                            "minimum": 0,
                            "maximum": 6000,
                            "description": "The number of seconds to wait before timing out."
                        },
                        "runAs": {
                            "type": "string",
                            "enum": [
                              "admin",
                              "user"
                            ],
                            "description": "Enum determining whether to run as admin or user. Default is user."
                        },
                        "sha256Hash": {
                            "type": "string",
                            "pattern": "^[A-Fa-f0-9]{64}$",
                            "description": "SHA256 hash of the resource."
                        },
                        "optional": {
                            "type": [ "boolean", "null" ],
                            "description": "Indicates whether to inform the orchestrator to prompt user for install. Default is false."
                        },
                        "confirm": {
                            "type": [ "boolean", "null" ],
                            "description": "Indicates whether to prompt the user for confirmation before initiation."
                        },
                        "signerThumbprint": {
                            "type": "string",
                            "pattern": "^[A-Fa-f0-9]{40}$",
                            "description": "The signer thumbprint."
                        },
                        "onFailure": {
                            "type": "string",
                            "enum": [
                              "continue",
                              "stop"
                            ],
                            "description": "Determines the behavior if a failure is encountered."
                        }
                    },
                    "additionalProperties": true
                },
                "settings": {
                    "type": "object"
                }
            },
            "required": [
                "resource",
                "id"
            ]
        },
        "id": {
            "type": "string",
            "maxLength": 128,
            "description": "The identifier of this item."
        },
        "module": {
            "type": "string",
            "maxLength": 128,
            "description": "The name of the module."
        },
        "description": {
            "type": "string",
            "maxLength": 512,
            "description": "The description of the desired state."
        },
        "version": {
            "type": "string",
            "pattern": "^(?P<major>0|[1-9]\\d*)\\.(?P<minor>0|[1-9]\\d*)\\.(?P<patch>0|[1-9]\\d*)(?:-(?P<prerelease>(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+(?P<buildmetadata>[0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
            "maxLength": 128
        }
    }
}